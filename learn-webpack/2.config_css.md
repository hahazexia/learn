# 配置和css处理

## 配置文件
* 默认在终端执行 webpack 命令的时候，会在当前目录下找 ./src/index.js 这个文件作为入口文件，然后进行打包。

如果我们想指定入口文件和打包输出目录的话，就可以在终端输入

```js
npx webpack --entry ./src/main.js --output-path ./build
// 入口文件为 ./src/main.js 打包输出目录为 ./build
```

命令行还可以添加哪些参数请到官方文档[这里](https://webpack.js.org/api/cli/#flags)查阅。

* 通过命令行的方式添加这些 webpack 的配置参数可读性差，也很麻烦，所以最常见的方式是在项目根目录下新建 `webpack.config.js` 文件，然后在其中用 commonjs 的方式导出一个对象即可。

```js
// webpack.config.js
const path = require('path')

module.exports = {
    entry: './src/main.js', // 入口文件
    output: { // 输出
        filename: 'bundle.js',
        path: path.resolve(__dirname, './build') // 必须是绝对路径
    }
}
```

## 指定配置文件名字

终端执行 webpack 命令的时候，默认会去找项目目录下的 webpack.config.js ，如果想要指定配置文件的名字，可以提供命令行参数：

```js
webpack --config wk.config.js
```

## webpack 依赖图

* 事实上webpack在处理应用程序时，它会根据命令或者配置文件找到入口文件
* 从入口开始，会生成一个`依赖关系图`，这个依赖关系图会包含应用程序中所需的所有模块（比如.js文件、css文件、图片、字体等）
* 然后`遍历图结构`，打包一个个模块（根据文件的不同使用不同的loader来解析）

## css-loader

当在 js 文件中引入了 css 文件后，使用 webpack 打包就会报错，这就是由于缺少 loader 去解析 css 文件。

* loader 可以用于对`模块的源代码`进行转换
* 我们可以将`css文件也看成是一个模块`，我们是通过`import来加载这个模块`的
* 在加载这个模块时，`webpack其实并不知道如何对其进行加载`，我们必须制定对应的loader来完成这个功能
* css-loader 可以读取 css 文件

但是安装完 css-loader 打包后会报错，因为没有告诉 webpack 怎么去将 css-loader 和 css 文件去做关联。

css-loader 的使用方式有三种：

* 内联方式

内联方式使用较少，因为不方便管理；在引入的样式前加上使用的loader，并且使用!分割；

```js
import 'css-loader!../css/style.css'
```

* cli 方式（webpack 5 已经不再支持）

* 配置文件方式。
    * module.rules中允许我们配置多个loader（因为我们也会继续使用其他的loader，来完成其他文件的加载）；
    * 这种方式可以更好的表示loader的配置，也方便后期的维护，同时也让你对各个Loader有一个全局的概览
    
    module.rules的配置如下：
    * rules属性对应的值是一个数组 `[rule]`
    * 数组中存放的是一个个的Rule，Rule是一个对象，对象中可以设置多个属性：
        * test属性：用于对 resource（资源）进行匹配的，通常会设置成正则表达式；
        * use属性：对应的值时一个数组：`[UseEntry]`
            * UseEntry是一个对象，可以通过对象的属性来设置一些其他属性
                * loader：必须有一个 loader属性，对应的值是一个字符串；
                * options：可选的属性，值是一个字符串或者对象，值会被传入到loader中；
                * query：目前已经使用options来替代
            * 传递字符串（如：use: [ 'style-loader' ]）是 loader 属性的简写方式（如：use: [ { loader: 'style-loader'} ]）
        * loader属性： Rule.use: [ { loader } ] 的简写。

```js
module: {
    rules: [
      {
        // 规则使用正则表达式
        test: /\.css$/, // 匹配资源
        use: [
          // { loader: "css-loader" },
          // 注意: 编写顺序(从下往上, 从右往做, 从后往前)
          "style-loader", 
          {
            loader: "css-loader",
            options: {
              importLoaders: 1
            }
          },
          "postcss-loader"
        ],
        // loader: "css-loader"
      }
    ]
  }
```